name: ci

on: ["push", "pull_request"]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: "18.14.0"
          cache: "yarn"
      - name: Install dependencies
        run: yarn --frozen-lockfile
      - name: Setup environment variables
        run: |
          echo "NEXT_PUBLIC_FIREBASE_API_KEY=AIzaSyAmodim2lJZBradsjx6Zl98hECO7vpo2To" >> $GITHUB_ENV
          echo "NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=dacade-d02d2.firebaseapp.com" >> $GITHUB_ENV
          echo "NEXT_PUBLIC_FIREBASE_PROJECT_ID=dacade-d02d2" >> $GITHUB_ENV
          echo "NEXT_PUBLIC_FIREBASE_APP_ID=1:194074425069:web:e519dce8d78a458d8b3ee4" >> $GITHUB_ENV
          echo "NEXT_PUBLIC_API_BASE_URL=https://us-central1-dacade-d02d2.cloudfunctions.net/api" >> $GITHUB_ENV
          echo "NEXT_PUBLIC_BUGSNAG_API_KEY=" >> $GITHUB_ENV
          echo "NEXT_PUBLIC_SHOW_LANGUAGE_SELECTOR=true" >> $GITHUB_ENV
          echo "NEXT_PUBLIC_DISCORD_CLIENT_ID=" >> $GITHUB_ENV
          echo "NEXT_PUBLIC_DISCORD_CALLBACK_URL=https://us-central1-dacade-d02d2.cloudfunctions.net/api/discord-bot/oauth/callback" >> $GITHUB_ENV
          echo "NEXT_PUBLIC_DISCORD_OAUTH_BASE_URL=https://discord.com/api/oauth2/authorize" >> $GITHUB_ENV
          echo "NEXT_PUBLIC_DISCORD_SCOPE=identify email" >> $GITHUB_ENV
          echo "NEXT_PUBLIC_GOOGLE_TRANSLATE_API_KEY=" >> $GITHUB_ENV
          echo "NEXT_PUBLIC_BLOCK_EXPLORER_URL=https://alfajores.celoscan.io" >> $GITHUB_ENV
          echo "NEXT_PUBLIC_IPFS_URL=https://gateway.pinata.cloud/ipfs/" >> $GITHUB_ENV

      - name: Run tests
        run: yarn test
